---
layout: post
title: How to add thirdparty libraries to an ASF4 project.
categories: [howto, tutorial]
tags: [sam, start, atmel, microchip, arm, microcontrollers]
---

The task is divided in three steps.

* Copy library files to the project.
* Update makefile with the new files routes.
* Resolve routes for include files on the added library.
* Integrate the library application code to the new application.
* Resolve variables or missing data.
* Enjoy.

I did this using Ubuntu 19.04

## Copy library files to the project.

In this case I required to add MQTT capabilities to the winc_tcp_server demo.
Original file structure is this.
![Original][Original_img]

Created a pahomqtt folder on root folder.
![PahoFolder][PahoFolder_img]

Copy the pahomqtt files from ASF3 thirdparty folder in tho the pahomqtt that was just created.
[][]

## Update makefile.

This is the trickier part, the Makefile generated by the START tool seems messy, so before adding the new files we clean it first. 

Makefile is located on the gcc folder.

[][]

Arrange the lines at the SUB_DIRS, OBJS, OBJS_AS_ARGS, DIR_INCLUDES, DEPS_AS_ARGS sections based on files and folder

[]][]

Add in each of the previous sections the paths and files required 
 * Every folder must appear
 * For each .c file a .o or .d file must appear.
 * include sections must reflect all folders that have a .h file.

![sub_dirs][sub_dirs_img]

![objs][objs_img]

![objs_as_args][objs_as_args_img]

![dir_includes][dir_includes_img]

![dep_as_args][dep_as_args_img]

## Resolve routes on includes.

The copied files were arranged on ASF3 fashion, so when imported some include paths will not be correct.
The way I fixed this is to run `make` on the gcc file and wait for the errors raised at compile, some of them will show that the file is unknown. So go there and fix those paths.




[Original_img]:

[sub_dirs_img]:/images/20200203_sub_dirs.png

[objs_img]:/images/20200203_objs.png

[objs_as_args_img]:/images/20200203_dep_as_args.png

[dir_includes_img]:/images/20200203_dir_includes.png
